<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coberturas bibliográficas por carrera</title>
    <!-- Carga de Tailwind CSS para estilos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Carga de Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #374151;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 1.5rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
            padding: 1.5rem;
        }
        .career-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr); /* Default para móviles */
            gap: 1rem;
        }
        @media (min-width: 640px) { /* sm */
            .career-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        @media (min-width: 1024px) { /* lg */
            .career-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        .percent-cell {
            padding: 0.5rem;
            border-radius: 0.5rem; /* rounded-lg */
            text-align: center;
            font-weight: 500;
            color: white;
            transition: transform 0.2s;
        }
        .percent-cell:hover {
            transform: scale(1.05);
        }

        /* Clases de utilidad para los porcentajes */
        .percent-high { background-color: #059669; /* green-600 */ }
        .percent-medium-high { background-color: #10B981; /* green-500 */ }
        .percent-medium { background-color: #F59E0B; /* yellow-500 */ }
        .percent-low { background-color: #EF4444; /* red-500 */ }
        .percent-unavailable { background-color: #9CA3AF; /* gray-400 */ }
        
        /* Estilo para el logo */
        .logo-container {
            position: absolute;
            top: 0;
            left: 0;
            padding: 1rem; /* p-4 */
            z-index: 1000; /* Asegura que el logo esté por encima de otros elementos */
        }
        .logo-container img {
            max-height: 60px; /* Ajusta el tamaño según sea necesario */
            width: auto;
            border-radius: 0.5rem; /* rounded-md */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Contenedor para el logo -->
    <div class="logo-container">
        <!-- Enlace al logo actualizado con la URL "raw" correcta -->
        <img src="https://raw.githubusercontent.com/pazrioseco/DashboardCRAI/main/LOGO%20CRAI.png" alt="Logo" onerror="this.onerror=null; this.src='https://placehold.co/150x60/cccccc/ffffff?text=Logo';" class="rounded-md">
    </div>

    <div class="container pt-24"> <!-- Aumentado el padding-top para dejar espacio para el logo -->
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-8 md:mb-12">Coberturas bibliográficas por carrera</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- Filtro de Facultad -->
            <div class="card">
                <label for="faculty-filter" class="block text-gray-700 text-lg font-medium mb-2">Filtrar por Facultad:</label>
                <select id="faculty-filter" class="block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-md">
                    <option value="all">Todas las Facultades</option>
                </select>
            </div>
            <!-- Filtro de Carrera -->
            <div class="card">
                <label for="career-filter" class="block text-gray-700 text-lg font-medium mb-2">Filtrar por Carrera:</label>
                <select id="career-filter" class="block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-md">
                    <option value="all">Todas las Carreras</option>
                </select>
            </div>
        </div>

        <!-- Resumen de KPIs con 4 columnas -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="card text-center">
                <p class="text-sm font-semibold text-gray-500 uppercase">BBAS Títulos Únicos</p>
                <p id="avg-bbas-unique" class="text-4xl font-bold text-teal-600 mt-2">N/A</p>
            </div>
            <div class="card text-center">
                <p class="text-sm font-semibold text-gray-500 uppercase">BCOM Títulos Únicos</p>
                <p id="avg-bcom-unique" class="text-4xl font-bold text-sky-600 mt-2">N/A</p>
            </div>
            <div class="card text-center">
                <p class="text-sm font-semibold text-gray-500 uppercase">BBAS EBOOKS</p>
                <p id="avg-bbas-ebooks" class="text-4xl font-bold text-indigo-600 mt-2">N/A</p>
            </div>
            <div class="card text-center">
                <p class="text-sm font-semibold text-gray-500 uppercase">BCOM EBOOKS</p>
                <p id="avg-bcom-ebooks" class="text-4xl font-bold text-rose-600 mt-2">N/A</p>
            </div>
        </div>

        <!-- Sección de tarjetas de carrera -->
        <div class="card mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Cobertura Porcentual por Carrera</h2>
            <div id="career-cards-container" class="career-grid">
                <p class="col-span-full text-center text-gray-500" id="cards-placeholder">Selecciona una facultad o carrera para ver los datos.</p>
            </div>
        </div>
    </div>

    <script>
        // --- DATOS ACTUALIZADOS SEGÚN LA TABLA ---
        // Se han añadido 4 propiedades para los porcentajes específicos
        const data = [
             // Fac. Administración y Negocios
            { faculty: "Fac. Administración y Negocios", career: "INGENIERÍA COMERCIAL", bbas_unique_percent: 97, bcom_unique_percent: 95, bbas_ebooks_percent: 43, bcom_ebooks_percent: 45 },
            { faculty: "Fac. Administración y Negocios", career: "INGENIERÍA EN ADMINISTRACIÓN", bbas_unique_percent: 90, bcom_unique_percent: 87, bbas_ebooks_percent: 51, bcom_ebooks_percent: 43 },
            { faculty: "Fac. Administración y Negocios", career: "INGENIERÍA EN CONTROL DE GESTIÓN", bbas_unique_percent: 92, bcom_unique_percent: 87, bbas_ebooks_percent: 52, bcom_ebooks_percent: 38 },

            // Fac. Arquitec. y Construcción
            { faculty: "Fac. Arquitec. y Construcción", career: "ARQUITECTURA", bbas_unique_percent: 92, bcom_unique_percent: 90, bbas_ebooks_percent: 20, bcom_ebooks_percent: 29 },
            { faculty: "Fac. Arquitec. y Construcción", career: "INGENIERÍA EN CONSTRUCCIÓN", bbas_unique_percent: 93, bcom_unique_percent: 96, bbas_ebooks_percent: 41, bcom_ebooks_percent: 48 },

            // Fac. Cs de la Salud
            { faculty: "Fac. Cs de la Salud", career: "ENFERMERÍA", bbas_unique_percent: 98, bcom_unique_percent: 98, bbas_ebooks_percent: 48, bcom_ebooks_percent: 51 },
            { faculty: "Fac. Cs de la Salud", career: "ODONTOLOGÍA", bbas_unique_percent: 94, bcom_unique_percent: 92, bbas_ebooks_percent: 31, bcom_ebooks_percent: 29 },
            { faculty: "Fac. Cs de la Salud", career: "FONOAUDIOLOGÍA", bbas_unique_percent: 96, bcom_unique_percent: 92, bbas_ebooks_percent: 12, bcom_ebooks_percent: 11 },
            { faculty: "Fac. Cs de la Salud", career: "KINESIOLOGÍA", bbas_unique_percent: 98, bcom_unique_percent: 98, bbas_ebooks_percent: 10, bcom_ebooks_percent: 7 },
            { faculty: "Fac. Cs de la Salud", career: "MEDICINA", bbas_unique_percent: 94, bcom_unique_percent: 88, bbas_ebooks_percent: 36, bcom_ebooks_percent: 33 },
            { faculty: "Fac. Cs de la Salud", career: "NUTRICIÓN Y DIETÉTICA", bbas_unique_percent: 92, bcom_unique_percent: 94, bbas_ebooks_percent: 8, bcom_ebooks_percent: 6 },
            { faculty: "Fac. Cs de la Salud", career: "OBSTETRICIA Y PUERICULTURA", bbas_unique_percent: 97, bcom_unique_percent: 97, bbas_ebooks_percent: 9, bcom_ebooks_percent: 10 },
            { faculty: "Fac. Cs de la Salud", career: "QUÍMICA Y FARMACIA", bbas_unique_percent: 91, bcom_unique_percent: 90, bbas_ebooks_percent: 11, bcom_ebooks_percent: 10 },
            { faculty: "Fac. Cs de la Salud", career: "TERAPIA OCUPACIONAL", bbas_unique_percent: 94, bcom_unique_percent: 95, bbas_ebooks_percent: 5, bcom_ebooks_percent: 5 },

            // Fac. Cs Sociales y Humanidades
            { faculty: "Fac. Cs Sociales y Humanidades", career: "PSICOLOGÍA", bbas_unique_percent: 98, bcom_unique_percent: 93, bbas_ebooks_percent: 42, bcom_ebooks_percent: 46 },
            { faculty: "Fac. Cs Sociales y Humanidades", career: "ADMINISTRACIÓN PÚBLICA", bbas_unique_percent: 90, bcom_unique_percent: 90, bbas_ebooks_percent: 61, bcom_ebooks_percent: 59 },
            { faculty: "Fac. Cs Sociales y Humanidades", career: "PERIODISMO", bbas_unique_percent: 92, bcom_unique_percent: 87, bbas_ebooks_percent: 37, bcom_ebooks_percent: 46 },
            { faculty: "Fac. Cs Sociales y Humanidades", career: "PUBLICIDAD PROFESIONAL Y COMUNICACIÓN INTEGRAL", bbas_unique_percent: 92, bcom_unique_percent: 85, bbas_ebooks_percent: 30, bcom_ebooks_percent: 26 },
            { faculty: "Fac. Cs Sociales y Humanidades", career: "TRABAJO SOCIAL", bbas_unique_percent: 93, bcom_unique_percent: 97, bbas_ebooks_percent: 47, bcom_ebooks_percent: 54 },

            // Fac. Derecho
            { faculty: "Fac. Derecho", career: "DERECHO", bbas_unique_percent: 97, bcom_unique_percent: 98, bbas_ebooks_percent: 61, bcom_ebooks_percent: 43 },

            // Fac. Educación
            { faculty: "Fac. Educación", career: "LICENCIATURA EN ARTES VISUALES", bbas_unique_percent: 79, bcom_unique_percent: 88, bbas_ebooks_percent: 20, bcom_ebooks_percent: 26 },
            { faculty: "Fac. Educación", career: "PEDAGOGÍA EN CASTELLANO", bbas_unique_percent: 90, bcom_unique_percent: 89, bbas_ebooks_percent: 36, bcom_ebooks_percent: 40 },
            { faculty: "Fac. Educación", career: "PEDAGOGÍA EN EDUCACIÓN BÁSICA", bbas_unique_percent: 86, bcom_unique_percent: 93, bbas_ebooks_percent: 42, bcom_ebooks_percent: 45 },
            { faculty: "Fac. Educación", career: "PEDAGOGÍA EN EDUCACIÓN DIFERENCIAL", bbas_unique_percent: 88, bcom_unique_percent: 90, bbas_ebooks_percent: 44, bcom_ebooks_percent: 49 },
            { faculty: "Fac. Educación", career: "PEDAGOGÍA EN EDUCACIÓN FÍSICA", bbas_unique_percent: 94, bcom_unique_percent: 92, bbas_ebooks_percent: 50, bcom_ebooks_percent: 55 },
            { faculty: "Fac. Educación", career: "PEDAGOGÍA EN HISTORIA, GEOGRAFÍA Y CIENCIAS SOCIALES", bbas_unique_percent: 91, bcom_unique_percent: 90, bbas_ebooks_percent: 35, bcom_ebooks_percent: 42 },
            { faculty: "Fac. Educación", career: "PEDAGOGÍA EN INGLÉS", bbas_unique_percent: 95, bcom_unique_percent: 95, bbas_ebooks_percent: 31, bcom_ebooks_percent: 31 },
            { faculty: "Fac. Educación", career: "PEDAGOGÍA EN EDUCACIÓN PARVULARIA", bbas_unique_percent: 95, bcom_unique_percent: 95, bbas_ebooks_percent: 56, bcom_ebooks_percent: 53 },

            // Fac. Ingeniería
            { faculty: "Fac. Ingeniería", career: "INGENIERÍA CIVIL INDUSTRIAL", bbas_unique_percent: 92, bcom_unique_percent: 94, bbas_ebooks_percent: 43, bcom_ebooks_percent: 46 },
            { faculty: "Fac. Ingeniería", career: "INGENIERÍA CIVIL INFORMÁTICA", bbas_unique_percent: 95, bcom_unique_percent: 92, bbas_ebooks_percent: 48, bcom_ebooks_percent: 43 },
            { faculty: "Fac. Ingeniería", career: "INGENIERÍA CIVIL QUÍMICA", bbas_unique_percent: 86, bcom_unique_percent: 86, bbas_ebooks_percent: 38, bcom_ebooks_percent: 34 },
        ];


        data.sort((a, b) => a.faculty.localeCompare(b.faculty) || a.career.localeCompare(b.career));

        const facultyFilter = document.getElementById('faculty-filter');
        const careerFilter = document.getElementById('career-filter');
        const avgBbasUniqueEl = document.getElementById('avg-bbas-unique');
        const avgBcomUniqueEl = document.getElementById('avg-bcom-unique');
        const avgBbasEbooksEl = document.getElementById('avg-bbas-ebooks');
        const avgBcomEbooksEl = document.getElementById('avg-bcom-ebooks');
        const careerCardsContainer = document.getElementById('career-cards-container');
        const cardsPlaceholder = document.getElementById('cards-placeholder');

        function initializeFilters() {
            const faculties = [...new Set(data.map(item => item.faculty))].sort();
            faculties.forEach(faculty => {
                const option = document.createElement('option');
                option.value = faculty;
                option.textContent = faculty;
                facultyFilter.appendChild(option);
            });
            updateCareerFilter();
        }

        function updateCareerFilter() {
            const selectedFaculty = facultyFilter.value;
            careerFilter.innerHTML = '<option value="all">Todas las Carreras</option>';
            const filteredCareers = selectedFaculty === 'all' ? data : data.filter(item => item.faculty === selectedFaculty);
            const careers = [...new Set(filteredCareers.map(item => item.career))].sort();
            careers.forEach(career => {
                const option = document.createElement('option');
                option.value = career;
                option.textContent = career;
                careerFilter.appendChild(option);
            });
            updateVisualizations();
        }

        function updateVisualizations() {
            const selectedFaculty = facultyFilter.value;
            const selectedCareer = careerFilter.value;
            const filteredData = data.filter(item => 
                (selectedFaculty === 'all' || item.faculty === selectedFaculty) &&
                (selectedCareer === 'all' || item.career === selectedCareer)
            );
            updateKPIs(filteredData);
            updateCareerCards(filteredData);
        }

        function calculateAverage(data, key) {
            const validItems = data.filter(item => typeof item[key] === 'number' && !isNaN(item[key]));
            if (validItems.length === 0) return 'N/A';
            const total = validItems.reduce((sum, item) => sum + item[key], 0);
            return `${(total / validItems.length).toFixed(1)}%`;
        }
        
        function updateKPIs(currentData) {
            avgBbasUniqueEl.textContent = calculateAverage(currentData, 'bbas_unique_percent');
            avgBcomUniqueEl.textContent = calculateAverage(currentData, 'bcom_unique_percent');
            avgBbasEbooksEl.textContent = calculateAverage(currentData, 'bbas_ebooks_percent');
            avgBcomEbooksEl.textContent = calculateAverage(currentData, 'bcom_ebooks_percent');
        }

        function getHeatmapColorClass(percentage) {
            if (typeof percentage !== 'number' || isNaN(percentage)) return 'percent-unavailable';
            if (percentage >= 90) return 'percent-high';
            if (percentage >= 80) return 'percent-medium-high';
            if (percentage >= 70) return 'percent-medium';
            return 'percent-low';
        }

        function updateCareerCards(currentData) {
            careerCardsContainer.innerHTML = '';
            if (currentData.length === 0) {
                careerCardsContainer.appendChild(cardsPlaceholder);
                cardsPlaceholder.classList.remove('hidden');
                return;
            }
            cardsPlaceholder.classList.add('hidden');

            currentData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card flex flex-col justify-between';
                
                const formatPercent = (p) => (typeof p === 'number' ? `${p}%` : 'N/A');

                card.innerHTML = `
                    <div>
                        <p class="text-sm font-semibold text-gray-500 mb-1">${item.faculty}</p>
                        <p class="text-xl font-bold text-gray-900 mb-4">${item.career}</p>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="percent-cell ${getHeatmapColorClass(item.bbas_unique_percent)}">
                            <p class="text-xs">BBAS T. Únicos</p>
                            <p class="text-lg font-bold">${formatPercent(item.bbas_unique_percent)}</p>
                        </div>
                        <div class="percent-cell ${getHeatmapColorClass(item.bcom_unique_percent)}">
                            <p class="text-xs">BCOM T. Únicos</p>
                            <p class="text-lg font-bold">${formatPercent(item.bcom_unique_percent)}</p>
                        </div>
                        <div class="percent-cell ${getHeatmapColorClass(item.bbas_ebooks_percent)}">
                            <p class="text-xs">BBAS Ebooks</p>
                            <p class="text-lg font-bold">${formatPercent(item.bbas_ebooks_percent)}</p>
                        </div>
                        <div class="percent-cell ${getHeatmapColorClass(item.bcom_ebooks_percent)}">
                            <p class="text-xs">BCOM Ebooks</p>
                            <p class="text-lg font-bold">${formatPercent(item.bcom_ebooks_percent)}</p>
                        </div>
                    </div>
                `;
                careerCardsContainer.appendChild(card);
            });
        }

        facultyFilter.addEventListener('change', updateCareerFilter);
        careerFilter.addEventListener('change', updateVisualizations);

        window.onload = () => {
            initializeFilters();
        };
    </script>
</body>
</html>

               